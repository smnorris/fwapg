

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Function reference &mdash; fwapg 0.7.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5a057da9"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Value added table/view reference" href="02_tables_views.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            fwapg
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_tables_views.html">Value added table/view reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Function reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fwa-downstream">FWA_Downstream</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-downstreamtrace">FWA_DownstreamTrace</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-indexpoint">FWA_IndexPoint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#options">Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#web-service">Web service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-locatealong">FWA_LocateAlong</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Web service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-locatealonginterval">FWA_LocateAlongInterval</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">Web service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-networktrace">FWA_NetworkTrace</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id14">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-1">Example 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-2">Example 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">Web service</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#marine-examples">Marine examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-networktraceagg">FWA_NetworkTraceAgg</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id17">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id19">Example 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20">Example 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">Web service</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id22">Marine examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-segmentalonginterval">FWA_SegmentAlongInterval</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id23">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-slopealonginterval">FWA_SlopeAlongInterval</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id26">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29">Web service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-streamsasmvt">FWA_StreamsAsMVT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id30">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id31">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id32">Web service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-upstream">FWA_Upstream</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id33">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id34">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id35">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-upstreamtrace">FWA_UpstreamTrace</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id36">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id37">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id38">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id39">Web service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fwa-watershedatmeasure">FWA_WatershedAtMeasure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id41">Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id42">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id43">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id44">Web service</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">fwapg</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Function reference</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/03_functions.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="function-reference">
<h1>Function reference<a class="headerlink" href="#function-reference" title="Link to this heading"></a></h1>
<section id="fwa-downstream">
<h2>FWA_Downstream<a class="headerlink" href="#fwa-downstream" title="Link to this heading"></a></h2>
<section id="synopsis">
<h3>Synopsis<a class="headerlink" href="#synopsis" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_Downstream</span><span class="p">(</span>
<span class="w">      </span><span class="n">wscode</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">      </span><span class="n">localcode</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">      </span><span class="n">wscode</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">      </span><span class="n">localcode</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">ltree</span>
<span class="p">)</span>

<span class="n">FWA_Downstream</span><span class="p">(</span>
<span class="w">    </span><span class="n">blue_line_key</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">downstream_route_measure</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="p">,</span>
<span class="w">    </span><span class="n">wscode_ltree</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">localcode_ltree</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">blue_line_key</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">downstream_route_measure</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="p">,</span>
<span class="w">    </span><span class="n">wscode_ltree</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">localcode_ltree</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">include_equivalents</span><span class="w"> </span><span class="nb">boolean</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">False</span><span class="p">,</span>
<span class="w">    </span><span class="n">tolerance</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">.</span><span class="mi">001</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="description">
<h3>Description<a class="headerlink" href="#description" title="Link to this heading"></a></h3>
<p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the watershed codes / measures B are downstream of watershed codes / measure A.</p>
<p>For polygonal features (where no <code class="docutils literal notranslate"><span class="pre">blue_line_key</span></code> / <code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code> is present), use the shorter form of the function.</p>
<p>For point locations referenced to the stream network, use the form of the function with <code class="docutils literal notranslate"><span class="pre">blue_line_key</span></code> and <code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code>.  Also, specify <code class="docutils literal notranslate"><span class="pre">True</span></code> for <code class="docutils literal notranslate"><span class="pre">include_equivalents</span></code> if you want to evaluate as true for features with exactly the same linear position.</p>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p>At its most basic, the function compares two watershed code / local code <code class="docutils literal notranslate"><span class="pre">ltree</span></code> pairs and returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the second pair is a parent of the first set (ie, downstream).</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">FWA_Downstream</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;100.100000.000100&#39;</span><span class="p">::</span><span class="n">ltree</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;100.100000.000100&#39;</span><span class="p">::</span><span class="n">ltree</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;100.100000&#39;</span><span class="p">::</span><span class="n">ltree</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;100.100000&#39;</span><span class="p">::</span><span class="n">ltree</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">fwa_downstream</span>
<span class="o">----------------</span>
 <span class="n">t</span>
</pre></div>
</div>
</li>
<li><p>Find features downstream of a known location on the network - this query finds the total length of stream downstream from Hope. Note that this result includes side channels, it is not necessarily the distance to the ocean:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">ROUND</span><span class="p">((</span><span class="k">SUM</span><span class="p">(</span><span class="n">st_length</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">geom</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">)::</span><span class="nb">numeric</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">length_dnstr_km</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">whse_basemapping</span><span class="p">.</span><span class="n">fwa_stream_networks_sp</span><span class="w"> </span><span class="n">s</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">FWA_Downstream</span><span class="p">(</span>
<span class="w">  </span><span class="mi">356364114</span><span class="p">,</span><span class="w"> </span><span class="mi">160400</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;100&#39;</span><span class="p">::</span><span class="n">ltree</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;100.113848&#39;</span><span class="p">::</span><span class="n">ltree</span><span class="p">,</span>
<span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">blue_line_key</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">downstream_route_measure</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">wscode_ltree</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">localcode_ltree</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">length_dnstr_km</span>
<span class="o">-----------------</span>
          <span class="mf">308.54</span>
</pre></div>
</div>
<p>Refine this slightly to find the distance to the ocean along the Fraser mainstem (where <code class="docutils literal notranslate"><span class="pre">blue_line_key</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">watershed_key</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">ROUND</span><span class="p">((</span><span class="k">SUM</span><span class="p">(</span><span class="n">st_length</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">geom</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">)::</span><span class="nb">numeric</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">length_dnstr_km</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">whse_basemapping</span><span class="p">.</span><span class="n">fwa_stream_networks_sp</span><span class="w"> </span><span class="n">s</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">FWA_Downstream</span><span class="p">(</span>
<span class="w">  </span><span class="mi">356364114</span><span class="p">,</span><span class="w"> </span><span class="mi">160400</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;100&#39;</span><span class="p">::</span><span class="n">ltree</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;100.113848&#39;</span><span class="p">::</span><span class="n">ltree</span><span class="p">,</span>
<span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">blue_line_key</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">downstream_route_measure</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">wscode_ltree</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">localcode_ltree</span>
<span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="n">watershed_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blue_line_key</span><span class="p">;</span><span class="w"> </span><span class="c1">-- do not include side channels</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">length_dnstr_km</span>
<span class="o">-----------------</span>
          <span class="mf">161.40</span>
</pre></div>
</div>
</li>
<li><p>For each feature in table A, find all records downstream in table B and collect them into an array. This query lists all dams downstream of each fish passage field assessment location (data from <a class="reference external" href="https://github.com/smnorris/bcfishpass"><code class="docutils literal notranslate"><span class="pre">bcfishpass</span></code></a>)</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">aggregated_crossings_id</span><span class="p">,</span>
<span class="w">  </span><span class="n">array_agg</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dam_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">downstream_dam_ids</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">bcfishpass</span><span class="p">.</span><span class="n">crossings</span><span class="w"> </span><span class="n">a</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">bcfishpass</span><span class="p">.</span><span class="n">dams</span><span class="w"> </span><span class="n">b</span>
<span class="k">ON</span><span class="w"> </span><span class="n">FWA_Downstream</span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">blue_line_key</span><span class="p">,</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">downstream_route_measure</span><span class="p">,</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">wscode_ltree</span><span class="p">,</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">localcode_ltree</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">blue_line_key</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">downstream_route_measure</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">wscode_ltree</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">localcode_ltree</span>
<span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">stream_crossing_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">aggregated_crossings_id</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">aggregated_crossings_id</span> <span class="o">|</span> <span class="n">downstream_dam_ids</span>
<span class="o">-------------------------+-----------------------</span>
                    <span class="mi">4790</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2343</span><span class="p">}</span>
                   <span class="mi">69233</span> <span class="o">|</span> <span class="p">{</span><span class="mi">917</span><span class="p">,</span><span class="mi">1801</span><span class="p">,</span><span class="mi">2165</span><span class="p">,</span><span class="mi">2310</span><span class="p">}</span>
                    <span class="mi">5468</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2472</span><span class="p">}</span>
                  <span class="mi">125252</span> <span class="o">|</span> <span class="p">{</span><span class="mi">15</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">213</span><span class="p">,</span><span class="mi">1917</span><span class="p">}</span>
                    <span class="mi">5697</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2472</span><span class="p">}</span>
                     <span class="mi">176</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2472</span><span class="p">}</span>
                     <span class="mi">576</span> <span class="o">|</span> <span class="p">{</span><span class="mi">426</span><span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="fwa-downstreamtrace">
<h2>FWA_DownstreamTrace<a class="headerlink" href="#fwa-downstreamtrace" title="Link to this heading"></a></h2>
<section id="id1">
<h3>Synopsis<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_DownstreamTrace</span><span class="p">(</span>
<span class="w">    </span><span class="n">start_blue_line_key</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">start_measure</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>
<span class="w">    </span><span class="n">tolerance</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Description<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>Return all data from <a class="reference external" href="https://smnorris.github.io/fwapg/03_tables_views.html#whse-basemapping-fwa-streams-vw"><code class="docutils literal notranslate"><span class="pre">whse_basemapping.streams_vw</span></code></a> downstream of provided location.</p>
<p>Provides a simpler interface to the basic use case of <code class="docutils literal notranslate"><span class="pre">FWA_Downstream()</span></code>, removing the need to use joins or watershed codes.</p>
<p>Notes:</p>
<ul class="simple">
<li><p>this is a draft function that has not been extensively optimized/tested, performance may suffer when working with major rivers</p></li>
<li><p>result will include side channels</p></li>
</ul>
</section>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h3>
<p>Return stream data downstream of Sheilds Lake:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">blue_line_key</span><span class="p">,</span>
<span class="w">  </span><span class="n">downstream_route_measure</span><span class="p">,</span>
<span class="w">  </span><span class="n">stream_order_parent</span><span class="p">,</span>
<span class="w">  </span><span class="n">channel_width</span><span class="p">,</span>
<span class="w">  </span><span class="n">geom</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">FWA_DownstreamTrace</span><span class="p">(</span><span class="mi">354146454</span><span class="p">,</span><span class="w"> </span><span class="mi">3150</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">blue_line_key</span> <span class="o">|</span> <span class="n">downstream_route_measure</span> <span class="o">|</span> <span class="n">stream_order_parent</span> <span class="o">|</span> <span class="n">channel_width</span> <span class="o">|</span> <span class="n">geom</span>
<span class="o">---------------+--------------------------+---------------------+---------------+------</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">3127.20524239473</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>               <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2965.37071386052</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>               <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2842.60982622329</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>               <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2679.16744750456</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>               <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2629.74618714613</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>               <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2609.65517389417</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.15</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2502.91937533387</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.15</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2394.95066476193</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.15</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2352.13213028193</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.15</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2240.02438811748</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.15</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2169.25535011117</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.15</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2138.31957468439</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.62</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">2025.39804344686</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.91</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">1992.73137196029</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.91</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>          <span class="mf">1847.8788247426</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.91</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">960.782490852403</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">2.91</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>         <span class="mf">660.760737217136</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">3.17</span> <span class="o">|</span>
     <span class="mi">354146454</span> <span class="o">|</span>                        <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">3</span> <span class="o">|</span>          <span class="mf">3.46</span> <span class="o">|</span>
     <span class="mi">354148774</span> <span class="o">|</span>          <span class="mf">3059.9040521127</span> <span class="o">|</span>                   <span class="mi">5</span> <span class="o">|</span>          <span class="mf">5.94</span> <span class="o">|</span>
     <span class="mi">354148774</span> <span class="o">|</span>         <span class="mf">2744.26659482523</span> <span class="o">|</span>                   <span class="mi">5</span> <span class="o">|</span>          <span class="mf">6.04</span> <span class="o">|</span>
     <span class="mi">354148774</span> <span class="o">|</span>         <span class="mf">1431.17077828375</span> <span class="o">|</span>                   <span class="mi">5</span> <span class="o">|</span>          <span class="mf">6.28</span> <span class="o">|</span>
     <span class="mi">354148774</span> <span class="o">|</span>         <span class="mf">1376.10785016488</span> <span class="o">|</span>                   <span class="mi">5</span> <span class="o">|</span>           <span class="mf">6.6</span> <span class="o">|</span>
     <span class="mi">354148774</span> <span class="o">|</span>         <span class="mf">1243.32075546327</span> <span class="o">|</span>                   <span class="mi">5</span> <span class="o">|</span>           <span class="mf">6.6</span> <span class="o">|</span>
     <span class="mi">354148774</span> <span class="o">|</span>         <span class="mf">710.353826210263</span> <span class="o">|</span>                   <span class="mi">5</span> <span class="o">|</span>           <span class="mf">6.6</span> <span class="o">|</span>
     <span class="mi">354148774</span> <span class="o">|</span>         <span class="mf">15.1842503508841</span> <span class="o">|</span>                   <span class="mi">5</span> <span class="o">|</span>           <span class="mf">8.5</span> <span class="o">|</span>
     <span class="mi">354148774</span> <span class="o">|</span>                        <span class="mi">0</span> <span class="o">|</span>                   <span class="mi">5</span> <span class="o">|</span>           <span class="mf">8.5</span> <span class="o">|</span>
     <span class="mi">354153927</span> <span class="o">|</span>         <span class="mf">4568.48427688637</span> <span class="o">|</span>                     <span class="o">|</span>         <span class="mf">32.26</span> <span class="o">|</span>
     <span class="o">...</span>
</pre></div>
</div>
</section>
</section>
<section id="fwa-indexpoint">
<h2>FWA_IndexPoint<a class="headerlink" href="#fwa-indexpoint" title="Link to this heading"></a></h2>
<section id="id3">
<h3>Synopsis<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_IndexPoint</span><span class="p">(</span>
<span class="w">    </span><span class="n">point</span><span class="w"> </span><span class="n">geometry</span><span class="p">(</span><span class="n">Point</span><span class="p">,</span><span class="w"> </span><span class="mi">3005</span><span class="p">),</span>
<span class="w">    </span><span class="n">tolerance</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span>
<span class="w">    </span><span class="n">num_features</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">FWA_IndexPoint</span><span class="p">(</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>
<span class="w">    </span><span class="n">srid</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">tolerance</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span>
<span class="w">    </span><span class="n">num_features</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3>Description<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>Snaps a point to the stream network. Provided a point (as either a BC Albers point geometry or (<code class="docutils literal notranslate"><span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">srid</span></code>), return a table containing the point geometry/geometries of the closest point(s) on the FWA stream network to the given point, plus additional attributes from the matched stream(s).</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>field</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">linear_feature_id</span></code></p></td>
<td><p>bigint</p></td>
<td><p>unique identifier of matched stream</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">gnis_name</span></code></p></td>
<td><p>text</p></td>
<td><p>stream name of matched stream</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">wscode_ltree</span></code></p></td>
<td><p>ltree</p></td>
<td><p>stream watershed code</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">localcode_ltree</span></code></p></td>
<td><p>ltree</p></td>
<td><p>stream local watershed code</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">blue_line_key</span></code></p></td>
<td><p>integer</p></td>
<td><p>stream blue line key (route identifier)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code></p></td>
<td><p>double precision</p></td>
<td><p>measure value of output point</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">distance_to_stream</span></code></p></td>
<td><p>double precision</p></td>
<td><p>distance from input point to output point</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">bc_ind</span></code></p></td>
<td><p>boolean</p></td>
<td><p>Indicates if the source point is in BC</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">geom</span></code></p></td>
<td><p>geometry(Point, 3005)</p></td>
<td><p>The closest point on the FWA stream network</p></td>
</tr>
</tbody>
</table>
</section>
<section id="options">
<h3>Options<a class="headerlink" href="#options" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tolerance</span></code> - Return only stream feature(s) within this distance (metres) (default = <code class="docutils literal notranslate"><span class="pre">5000</span></code>)<br />
<code class="docutils literal notranslate"><span class="pre">num_features</span></code> - Number of features to be returned (default = <code class="docutils literal notranslate"><span class="pre">1</span></code>)</p>
</section>
<section id="id5">
<h3>Examples<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p>Return the closest point on FWA stream network to a point defined by a lon/lat (within default 5000m tolerance):</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FWA_IndexPoint</span><span class="p">(</span><span class="o">-</span><span class="mi">123</span><span class="p">.</span><span class="mi">7028</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">3858</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">linear_feature_id</span> <span class="o">|</span>  <span class="n">gnis_name</span>  <span class="o">|</span> <span class="n">wscode_ltree</span> <span class="o">|</span> <span class="n">localcode_ltree</span> <span class="o">|</span> <span class="n">blue_line_key</span> <span class="o">|</span> <span class="n">downstream_route_measure</span> <span class="o">|</span> <span class="n">distance_to_stream</span> <span class="o">|</span> <span class="n">bc_ind</span> <span class="o">|</span>                        <span class="n">geom</span>
<span class="o">-------------------+-------------+--------------+-----------------+---------------+--------------------------+--------------------+--------+----------------------------------------------------</span>
         <span class="mi">710513719</span> <span class="o">|</span> <span class="n">Sooke</span> <span class="n">River</span> <span class="o">|</span> <span class="mf">930.023810</span>   <span class="o">|</span> <span class="mf">930.023810</span>      <span class="o">|</span>     <span class="mi">354153927</span> <span class="o">|</span>        <span class="mf">350.2530543284006</span> <span class="o">|</span>             <span class="mf">24.228</span> <span class="o">|</span> <span class="n">t</span>      <span class="o">|</span> <span class="mi">0101000020</span><span class="n">BD0B0000D579287B42DC314198937D515C061741</span>
</pre></div>
</div>
</li>
<li><p>Index a set of point geometries, finding up to 10 features within 100m:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">pts</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
<span class="w">  </span><span class="n">i</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">VALUES</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;07EA004&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_MakePoint</span><span class="p">(</span><span class="mi">1054676</span><span class="p">,</span><span class="w"> </span><span class="mi">1304723</span><span class="p">),</span><span class="w"> </span><span class="mi">3005</span><span class="p">)),</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;07EA005&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_MakePoint</span><span class="p">(</span><span class="mi">1045356</span><span class="p">,</span><span class="w"> </span><span class="mi">1348750</span><span class="p">),</span><span class="w"> </span><span class="mi">3005</span><span class="p">)),</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;07EA007&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_MakePoint</span><span class="p">(</span><span class="mi">1066334</span><span class="p">,</span><span class="w"> </span><span class="mi">1356262</span><span class="p">),</span><span class="w"> </span><span class="mi">3005</span><span class="p">)),</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;07EB002&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_MakePoint</span><span class="p">(</span><span class="mi">1126747</span><span class="p">,</span><span class="w"> </span><span class="mi">1283184</span><span class="p">),</span><span class="w"> </span><span class="mi">3005</span><span class="p">)),</span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;07EC002&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_MakePoint</span><span class="p">(</span><span class="mi">1089342</span><span class="p">,</span><span class="w"> </span><span class="mi">1214473</span><span class="p">),</span><span class="w"> </span><span class="mi">3005</span><span class="p">))</span>
<span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pts</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="p">)</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">LATERAL</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="w">  </span><span class="k">FROM</span>
<span class="w">  </span><span class="n">FWA_IndexPoint</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="nb">id</span>    <span class="o">|</span> <span class="n">linear_feature_id</span> <span class="o">|</span>   <span class="n">gnis_name</span>    <span class="o">|</span>       <span class="n">wscode_ltree</span>       <span class="o">|</span>         <span class="n">localcode_ltree</span>         <span class="o">|</span> <span class="n">blue_line_key</span> <span class="o">|</span> <span class="n">downstream_route_measure</span> <span class="o">|</span> <span class="n">distance_to_stream</span> <span class="o">|</span> <span class="n">bc_ind</span> <span class="o">|</span>                        <span class="n">geom</span>
<span class="o">---------+-------------------+----------------+--------------------------+---------------------------------+---------------+--------------------------+--------------------+--------+----------------------------------------------------</span>
 <span class="mi">07</span><span class="n">EA004</span> <span class="o">|</span>          <span class="mi">68051401</span> <span class="o">|</span> <span class="n">Ingenika</span> <span class="n">River</span> <span class="o">|</span> <span class="mf">200.948755.992594</span>        <span class="o">|</span> <span class="mf">200.948755.992594.039418</span>        <span class="o">|</span>     <span class="mi">359571145</span> <span class="o">|</span>        <span class="mf">6096.256539019577</span> <span class="o">|</span>             <span class="mf">41.319</span> <span class="o">|</span> <span class="n">t</span>      <span class="o">|</span> <span class="mi">0101000020</span><span class="n">BD0B00007FFBC4C0C617304173BF3D23BAE83341</span>
 <span class="mi">07</span><span class="n">EA004</span> <span class="o">|</span>          <span class="mi">68051402</span> <span class="o">|</span>                <span class="o">|</span> <span class="mf">200.948755.992594.042767</span> <span class="o">|</span> <span class="mf">200.948755.992594.042767</span>        <span class="o">|</span>     <span class="mi">359233576</span> <span class="o">|</span>                        <span class="mi">0</span> <span class="o">|</span>              <span class="mf">46.77</span> <span class="o">|</span> <span class="n">t</span>      <span class="o">|</span> <span class="mi">0101000020</span><span class="n">BD0B000023DBF9FEB11730413108AC1CB3E83341</span>
 <span class="mi">07</span><span class="n">EA005</span> <span class="o">|</span>          <span class="mi">49095881</span> <span class="o">|</span> <span class="n">Finlay</span> <span class="n">River</span>   <span class="o">|</span> <span class="mf">200.948755.999851</span>        <span class="o">|</span> <span class="mf">200.948755.999851.137838</span>        <span class="o">|</span>     <span class="mi">359569942</span> <span class="o">|</span>        <span class="mf">42909.36746325051</span> <span class="o">|</span>             <span class="mf">47.258</span> <span class="o">|</span> <span class="n">t</span>      <span class="o">|</span> <span class="mi">0101000020</span><span class="n">BD0B0000C3F5289C79E62F41508D976E90943441</span>
 <span class="mi">07</span><span class="n">EA007</span> <span class="o">|</span>          <span class="mi">49083226</span> <span class="o">|</span> <span class="n">Akie</span> <span class="n">River</span>     <span class="o">|</span> <span class="mf">200.948755.999851.088011</span> <span class="o">|</span> <span class="mf">200.948755.999851.088011.231827</span> <span class="o">|</span>     <span class="mi">359571761</span> <span class="o">|</span>        <span class="mf">29215.40257114563</span> <span class="o">|</span>             <span class="mf">40.442</span> <span class="o">|</span> <span class="n">t</span>      <span class="o">|</span> <span class="mi">0101000020</span><span class="n">BD0B000037B9E4F44B4530410DDF6ACEC1B13441</span>
 <span class="mi">07</span><span class="n">EB002</span> <span class="o">|</span>         <span class="mi">161051216</span> <span class="o">|</span> <span class="n">Ospika</span> <span class="n">River</span>   <span class="o">|</span> <span class="mf">200.948755.951156</span>        <span class="o">|</span> <span class="mf">200.948755.951156.201899</span>        <span class="o">|</span>     <span class="mi">359573063</span> <span class="o">|</span>       <span class="mf">29005.449548147713</span> <span class="o">|</span>             <span class="mf">41.647</span> <span class="o">|</span> <span class="n">t</span>      <span class="o">|</span> <span class="mi">0101000020</span><span class="n">BD0B0000D7D491C73F3131419708AD7A50943341</span>
 <span class="mi">07</span><span class="n">EC002</span> <span class="o">|</span>         <span class="mi">115033725</span> <span class="o">|</span> <span class="n">Omineca</span> <span class="n">River</span>  <span class="o">|</span> <span class="mf">200.948755.944288</span>        <span class="o">|</span> <span class="mf">200.948755.944288.110746</span>        <span class="o">|</span>     <span class="mi">359571933</span> <span class="o">|</span>        <span class="mf">29317.40902691083</span> <span class="o">|</span>             <span class="mf">95.125</span> <span class="o">|</span> <span class="n">t</span>      <span class="o">|</span> <span class="mi">0101000020</span><span class="n">BD0B000054618DD09A9F3041A0D25C29F4873241</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="web-service">
<h3>Web service<a class="headerlink" href="#web-service" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://features.hillcrestgeo.ca/fwa/functions/fwa_indexpoint.html">FWA_IndexPoint</a></p>
</section>
</section>
<section id="fwa-locatealong">
<h2>FWA_LocateAlong<a class="headerlink" href="#fwa-locatealong" title="Link to this heading"></a></h2>
<section id="id6">
<h3>Synopsis<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_LocateAlong</span><span class="p">(</span><span class="n">blue_line_key</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">downstream_route_measure</span><span class="w"> </span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id7">
<h3>Description<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<p>Return a table containing a single point geometry corresponding to the position on the FWA stream network of input <code class="docutils literal notranslate"><span class="pre">blue_line_key</span></code>, <code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code>.</p>
</section>
<section id="id8">
<h3>Example<a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<p>Create a point geometry at measure 25,000 on the Skeena River:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span>
<span class="w">        </span><span class="n">FWA_LocateAlong</span><span class="p">(</span>
<span class="w">          </span><span class="p">(</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">blue_line_key</span>
<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">whse_basemapping</span><span class="p">.</span><span class="n">fwa_stream_networks_sp</span>
<span class="w">            </span><span class="k">WHERE</span><span class="w"> </span><span class="n">gnis_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Skeena River&#39;</span>
<span class="w">          </span><span class="p">),</span>
<span class="w">        </span><span class="mi">25000</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                         <span class="n">st_astext</span>
<span class="o">-----------------------------------------------------------</span>
 <span class="n">POINT</span> <span class="n">ZM</span> <span class="p">(</span><span class="mf">754013.9457165595</span> <span class="mf">1029911.1568720527</span> <span class="mf">5.5</span> <span class="mi">25000</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="id9">
<h3>Web service<a class="headerlink" href="#id9" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://features.hillcrestgeo.ca/fwa/functions/fwa_locatealong.html">FWA_LocateAlong</a></p>
</section>
</section>
<section id="fwa-locatealonginterval">
<h2>FWA_LocateAlongInterval<a class="headerlink" href="#fwa-locatealonginterval" title="Link to this heading"></a></h2>
<section id="id10">
<h3>Synopsis<a class="headerlink" href="#id10" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_LocateAlongInterval</span><span class="p">(</span>
<span class="w">  </span><span class="n">blue_line_key</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">interval_length</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">  </span><span class="n">start_measure</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">end_measure</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3>Description<a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<p>Return a table representing points along a stream between input locations at specified interval.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>field</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>integer</p></td>
<td><p>0 based index of returned features</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code></p></td>
<td><p>double precision</p></td>
<td><p>measure value of output point</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">geom</span></code></p></td>
<td><p>geometry(Point, 3005)</p></td>
<td><p>Point geometry at the measure</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id12">
<h3>Example<a class="headerlink" href="#id12" title="Link to this heading"></a></h3>
<p>Return points at a 1km interval along the Peace between Site C and Bennet dams:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">SELECT</span>
<span class="w">     </span><span class="k">index</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">     </span><span class="n">downstream_route_measure</span><span class="p">,</span>
<span class="w">     </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">FWA_LocateAlongInterval</span><span class="p">(</span>
<span class="w">    </span><span class="mi">359572348</span><span class="p">,</span>
<span class="w">    </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">    </span><span class="mi">1597489</span><span class="p">,</span>
<span class="w">    </span><span class="mi">1706733</span>
<span class="w">    </span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="nb">id</span>  <span class="o">|</span> <span class="n">downstream_route_measure</span> <span class="o">|</span>                                  <span class="n">st_astext</span>
<span class="o">-----+--------------------------+-----------------------------------------------------------------------------</span>
   <span class="mi">0</span> <span class="o">|</span>                  <span class="mi">1597489</span> <span class="o">|</span> <span class="n">POINT</span> <span class="n">ZM</span> <span class="p">(</span><span class="mf">1314468.0708699157</span> <span class="mf">1256099.567354601</span> <span class="mf">412.98247677532964</span> <span class="mi">1597489</span><span class="p">)</span>
   <span class="mi">1</span> <span class="o">|</span>                  <span class="mi">1598489</span> <span class="o">|</span> <span class="n">POINT</span> <span class="n">ZM</span> <span class="p">(</span><span class="mf">1313779.3421101477</span> <span class="mf">1256817.5566858777</span> <span class="mf">413.709000000003</span> <span class="mi">1598489</span><span class="p">)</span>
   <span class="mi">2</span> <span class="o">|</span>                  <span class="mi">1599489</span> <span class="o">|</span> <span class="n">POINT</span> <span class="n">ZM</span> <span class="p">(</span><span class="mf">1313217.588407995</span> <span class="mf">1257612.8656611862</span> <span class="mf">413.9290255060764</span> <span class="mi">1599489</span><span class="p">)</span>
   <span class="mi">3</span> <span class="o">|</span>                  <span class="mi">1600489</span> <span class="o">|</span> <span class="n">POINT</span> <span class="n">ZM</span> <span class="p">(</span><span class="mf">1312633.1479665248</span> <span class="mf">1258419.2668507479</span> <span class="mi">414</span> <span class="mi">1600489</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Mapping the returned features:</p>
<p><img alt="watershed" src="_images/locatealonginterval.png" /></p>
</section>
<section id="id13">
<h3>Web service<a class="headerlink" href="#id13" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://features.hillcrestgeo.ca/fwa/functions/fwa_locatealonginterval.html">FWA_LocateAlongInterval</a></p>
<p>Make the same request as the example above, but <a href="https://features.hillcrestgeo.ca/fwa/functions/fwa_locatealonginterval/items.html?blue_line_key=359572348&start_measure=1597489&interval_length=10000&end_measure=1706733&limit=100">at 10km</a></p>
</section>
</section>
<section id="fwa-networktrace">
<h2>FWA_NetworkTrace<a class="headerlink" href="#fwa-networktrace" title="Link to this heading"></a></h2>
<section id="id14">
<h3>Synopsis<a class="headerlink" href="#id14" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_NetworkTrace</span><span class="p">(</span>
<span class="w">  </span><span class="n">blue_line_key_a</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="n">measure_a</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="w">  </span><span class="n">blue_line_key_b</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="n">measure_b</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="w">  </span><span class="n">tolerance</span><span class="w"> </span><span class="nb">FLOAT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id15">
<h3>Description<a class="headerlink" href="#id15" title="Link to this heading"></a></h3>
<p>Return a table of all stream network features that connect the provided locations, not including side-channels.
Stream network geometries are split at the locations provided, if the stream endpoints are not located within the distance specified by the tolerance.
Fields included are as per <a class="reference external" href="https://smnorris.github.io/fwapg/03_tables_views.html#whse-basemapping-fwa-streams"><code class="docutils literal notranslate"><span class="pre">whse_basemapping.fwa_streams</span></code></a>.</p>
<p>Note that the function will return data for any provided locations, even if the locations are not connected by the source stream network (ie the connection is marine).</p>
</section>
<section id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Link to this heading"></a></h3>
<p>Return stream segments between a point on a trib to Chipman Creek and a point on the Chemainus River upstream of its confluence with Chipman Creek:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">linear_feature_id</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">blue_line_key</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">downstream_route_measure</span><span class="p">,</span>
<span class="w">    </span><span class="n">channel_width</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">fwa_networktrace</span><span class="p">(</span><span class="mi">354132308</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="mi">354154440</span><span class="p">,</span><span class="w"> </span><span class="mi">37100</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">linear_feature_id</span> <span class="o">|</span> <span class="n">blue_line_key</span> <span class="o">|</span> <span class="n">downstream_route_measure</span> <span class="o">|</span> <span class="n">channel_width</span> 
<span class="o">-------------------+---------------+--------------------------+---------------</span>
         <span class="mi">710035813</span> <span class="o">|</span>     <span class="mi">354132308</span> <span class="o">|</span>         <span class="mf">1012.21665141576</span> <span class="o">|</span>              
         <span class="mi">710275878</span> <span class="o">|</span>     <span class="mi">354132308</span> <span class="o">|</span>                        <span class="mi">0</span> <span class="o">|</span>              
         <span class="mi">710276079</span> <span class="o">|</span>     <span class="mi">354155015</span> <span class="o">|</span>         <span class="mf">3461.16658988312</span> <span class="o">|</span>         <span class="mf">14.05</span>
         <span class="mi">710035785</span> <span class="o">|</span>     <span class="mi">354155015</span> <span class="o">|</span>         <span class="mf">3303.08602877688</span> <span class="o">|</span>         <span class="mf">14.23</span>
         <span class="mi">710276267</span> <span class="o">|</span>     <span class="mi">354155015</span> <span class="o">|</span>         <span class="mf">3128.21026243096</span> <span class="o">|</span>         <span class="mf">14.23</span>
<span class="o">...</span>
         <span class="mi">710035875</span> <span class="o">|</span>     <span class="mi">354154440</span> <span class="o">|</span>         <span class="mf">35217.0414128426</span> <span class="o">|</span>         <span class="mf">26.16</span>
         <span class="mi">710277390</span> <span class="o">|</span>     <span class="mi">354154440</span> <span class="o">|</span>         <span class="mf">34335.5545669658</span> <span class="o">|</span>         <span class="mf">12.38</span>
         <span class="mi">710277402</span> <span class="o">|</span>     <span class="mi">354154440</span> <span class="o">|</span>         <span class="mf">34080.2453081494</span> <span class="o">|</span>         <span class="mf">10.22</span>
         <span class="mi">710277776</span> <span class="o">|</span>     <span class="mi">354154440</span> <span class="o">|</span>         <span class="mf">32101.5933103956</span> <span class="o">|</span>         <span class="mf">16.35</span>
         <span class="mi">710277690</span> <span class="o">|</span>     <span class="mi">354154440</span> <span class="o">|</span>         <span class="mf">31792.5224498383</span> <span class="o">|</span>          <span class="mf">23.1</span>

</pre></div>
</div>
</section>
<section id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Link to this heading"></a></h3>
<p>Return stream segments between a point high in the Shushwap watershed and the Fraser River at Chilliwack:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">linear_feature_id</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">blue_line_key</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">downstream_route_measure</span><span class="p">,</span>
<span class="w">    </span><span class="n">channel_width</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">fwa_networktrace</span><span class="p">(</span><span class="mi">356135133</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">356364114</span><span class="p">,</span><span class="w"> </span><span class="mi">96830</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">linear_feature_id</span> <span class="o">|</span> <span class="n">blue_line_key</span> <span class="o">|</span> <span class="n">downstream_route_measure</span> <span class="o">|</span> <span class="n">channel_width</span> 
<span class="o">-------------------+---------------+--------------------------+---------------</span>
         <span class="mi">703007983</span> <span class="o">|</span>     <span class="mi">356135133</span> <span class="o">|</span>                        <span class="mi">0</span> <span class="o">|</span>          <span class="mf">3.97</span>
         <span class="mi">703008157</span> <span class="o">|</span>     <span class="mi">356317350</span> <span class="o">|</span>         <span class="mf">3909.84772689516</span> <span class="o">|</span>         <span class="mf">10.35</span>
         <span class="mi">703008165</span> <span class="o">|</span>     <span class="mi">356317350</span> <span class="o">|</span>         <span class="mf">3752.92413279951</span> <span class="o">|</span>         <span class="mf">10.38</span>
         <span class="mi">703008171</span> <span class="o">|</span>     <span class="mi">356317350</span> <span class="o">|</span>         <span class="mf">3574.52153685271</span> <span class="o">|</span>         <span class="mf">12.23</span>
         <span class="mi">703008202</span> <span class="o">|</span>     <span class="mi">356317350</span> <span class="o">|</span>         <span class="mf">3437.52168976849</span> <span class="o">|</span>         <span class="mf">12.25</span>
<span class="o">...</span>
         <span class="mi">701348760</span> <span class="o">|</span>     <span class="mi">356364114</span> <span class="o">|</span>         <span class="mf">97872.6823525415</span> <span class="o">|</span>       <span class="mf">1098.79</span>
         <span class="mi">701348775</span> <span class="o">|</span>     <span class="mi">356364114</span> <span class="o">|</span>         <span class="mf">97748.0754848264</span> <span class="o">|</span>       <span class="mf">1150.12</span>
         <span class="mi">701348786</span> <span class="o">|</span>     <span class="mi">356364114</span> <span class="o">|</span>         <span class="mf">97691.4227605892</span> <span class="o">|</span>       <span class="mf">1168.85</span>
         <span class="mi">701348810</span> <span class="o">|</span>     <span class="mi">356364114</span> <span class="o">|</span>         <span class="mf">97382.5273775604</span> <span class="o">|</span>       <span class="mf">1167.24</span>
         <span class="mi">701348868</span> <span class="o">|</span>     <span class="mi">356364114</span> <span class="o">|</span>                    <span class="mi">96830</span> <span class="o">|</span>       <span class="mf">1011.92</span>

</pre></div>
</div>
</section>
<section id="id16">
<h3>Web service<a class="headerlink" href="#id16" title="Link to this heading"></a></h3>
<p>Make the same requests as the examples above:</p>
<ul class="simple">
<li><p><a href="https://features.hillcrestgeo.ca/fwa/functions/fwa_networktrace/items.html?blue_line_key_a=354132308&measure_a=2000&blue_line_key_b=354154440&measure_b=37100">Chipman Creek - Chemainus River</a></p></li>
<li><p><a href="https://features.hillcrestgeo.ca/fwa/functions/fwa_networktrace/items.html?blue_line_key_a=356135133&measure_a=200&blue_line_key_b=356364114&measure_b=96830">Upper Shushwap - Fraser &#64; Chillwack</a></p></li>
</ul>
<section id="marine-examples">
<h4>Marine examples<a class="headerlink" href="#marine-examples" title="Link to this heading"></a></h4>
<p>Paths returned are the most direct route a fish or paddler could take between two locations, exluding portions of the path that are marine or not in BC:</p>
<ul class="simple">
<li><p>between <a href="https://features.hillcrestgeo.ca/fwa/functions/postgisftw.fwa_networktrace/items.html?blue_line_key_a=354142279&measure_a=1000&blue_line_key_b=354106004&measure_b=200">opposite sides of Finlayson Arm</a></p></li>
<li><p>between <a href="https://features.hillcrestgeo.ca/fwa/functions/postgisftw.fwa_networktrace/items.html?blue_line_key_a=356364114&measure_a=96830&blue_line_key_b=356570348&measure_b=41162">Chilliwack and Nelson</a></p></li>
</ul>
</section>
</section>
</section>
<section id="fwa-networktraceagg">
<h2>FWA_NetworkTraceAgg<a class="headerlink" href="#fwa-networktraceagg" title="Link to this heading"></a></h2>
<section id="id17">
<h3>Synopsis<a class="headerlink" href="#id17" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_NetworkTraceAgg</span><span class="p">(</span>
<span class="w">  </span><span class="n">blue_line_key_a</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="n">measure_a</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="w">  </span><span class="n">blue_line_key_b</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">  </span><span class="n">measure_b</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="w">  </span><span class="n">tolerance</span><span class="w"> </span><span class="nb">FLOAT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id18">
<h3>Description<a class="headerlink" href="#id18" title="Link to this heading"></a></h3>
<p>Return a table of paths (aggregated stream network linestrings) connecting the provided locations, not including side-channels.
Stream network geometries are split at the locations provided, if the stream endpoints are not located within the distance specified by the tolerance.
The function will return one path if the provided locations are flow connected (upstream/downstream), two paths if they are not.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>field</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>integer</p></td>
<td><p>1 based index of returned features</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">from_blue_line_key</span></code></p></td>
<td><p>integer</p></td>
<td><p>blue_line_key of starting point / point a</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">from_measure</span></code></p></td>
<td><p>double precision</p></td>
<td><p>measure value at starting point / point a</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">to_blue_line_key</span></code></p></td>
<td><p>integer</p></td>
<td><p>blue_line_key of ending point / point b</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">to_measure</span></code></p></td>
<td><p>double precision</p></td>
<td><p>measure value at ending point / point b</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">geom</span></code></p></td>
<td><p>geometry(LinestringZ, 3005)</p></td>
<td><p>geometry of the path</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id19">
<h3>Example 1<a class="headerlink" href="#id19" title="Link to this heading"></a></h3>
<p>Return the path between a point on a trib to Chipman Creek and a point on the Chemainus River upstream of its confluence with Chipman Creek:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="n">from_blue_line_key</span><span class="p">,</span>
<span class="w">    </span><span class="n">from_measure</span><span class="p">,</span>
<span class="w">    </span><span class="n">to_blue_line_key</span><span class="p">,</span>
<span class="w">    </span><span class="n">to_measure</span><span class="p">,</span>
<span class="w">    </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">geom</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">fwa_networktraceagg</span><span class="p">(</span><span class="mi">354132308</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="mi">354154440</span><span class="p">,</span><span class="w"> </span><span class="mi">37100</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="nb">id</span> <span class="o">|</span> <span class="n">from_blue_line_key</span> <span class="o">|</span> <span class="n">from_measure</span> <span class="o">|</span> <span class="n">to_blue_line_key</span> <span class="o">|</span>    <span class="n">to_measure</span>    <span class="o">|</span> <span class="n">geom</span> 
<span class="o">----+--------------------+--------------+------------------+------------------+-----</span>
  <span class="mi">1</span> <span class="o">|</span>          <span class="mi">354132308</span> <span class="o">|</span>         <span class="mi">2000</span> <span class="o">|</span>        <span class="mi">354155015</span> <span class="o">|</span>                <span class="mi">0</span> <span class="o">|</span> <span class="n">LINESTRING</span> <span class="n">Z</span> <span class="p">(</span><span class="o">...</span>
  <span class="mi">2</span> <span class="o">|</span>          <span class="mi">354154440</span> <span class="o">|</span>        <span class="mi">37100</span> <span class="o">|</span>        <span class="mi">354154440</span> <span class="o">|</span> <span class="mf">31792.5224498383</span> <span class="o">|</span> <span class="n">LINESTRING</span> <span class="n">Z</span> <span class="p">(</span><span class="o">...</span>

</pre></div>
</div>
</section>
<section id="id20">
<h3>Example 2<a class="headerlink" href="#id20" title="Link to this heading"></a></h3>
<p>Return the path between a point high in the Shushwap watershed and the Fraser River at Chilliwack:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="n">from_blue_line_key</span><span class="p">,</span>
<span class="w">    </span><span class="n">from_measure</span><span class="p">,</span>
<span class="w">    </span><span class="n">to_blue_line_key</span><span class="p">,</span>
<span class="w">    </span><span class="n">to_measure</span><span class="p">,</span>
<span class="w">    </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">geom</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">fwa_networktraceagg</span><span class="p">(</span><span class="mi">356135133</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">356364114</span><span class="p">,</span><span class="w"> </span><span class="mi">96830</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="nb">id</span> <span class="o">|</span> <span class="n">from_blue_line_key</span> <span class="o">|</span> <span class="n">from_measure</span> <span class="o">|</span> <span class="n">to_blue_line_key</span> <span class="o">|</span> <span class="n">to_measure</span> <span class="o">|</span> <span class="n">geom</span>
 <span class="o">----+--------------------+--------------+------------------+------------+-----</span>                                                                                                                 
  <span class="mi">1</span>  <span class="o">|</span>          <span class="mi">356135133</span> <span class="o">|</span>          <span class="mi">200</span> <span class="o">|</span>        <span class="mi">356364114</span> <span class="o">|</span>      <span class="mi">96830</span> <span class="o">|</span> <span class="n">LINESTRING</span> <span class="n">Z</span> 
</pre></div>
</div>
</section>
<section id="id21">
<h3>Web service<a class="headerlink" href="#id21" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://features.hillcrestgeo.ca/fwa/functions/fwa_networktraceagg.html">FWA_NetworkTraceAgg</a></p>
<p>Make the same requests as the examples above:</p>
<ul class="simple">
<li><p><a href="https://features.hillcrestgeo.ca/fwa/functions/fwa_networktraceagg/items.html?blue_line_key_a=354132308&measure_a=2000&blue_line_key_b=354154440&measure_b=37100">Chipman Creek - Chemainus River</a></p></li>
<li><p><a href="https://features.hillcrestgeo.ca/fwa/functions/fwa_networktraceagg/items.html?blue_line_key_a=356135133&measure_a=200&blue_line_key_b=356364114&measure_b=96830">Upper Shushwap - Fraser &#64; Chillwack</a></p></li>
</ul>
<section id="id22">
<h4>Marine examples<a class="headerlink" href="#id22" title="Link to this heading"></a></h4>
<p>As with <code class="docutils literal notranslate"><span class="pre">FWA_NetworkTrace()</span></code>, paths returned are the most direct route a fish or paddler could take between two locations, exluding portions of the path that are marine or not in BC:</p>
<ul class="simple">
<li><p>between <a href="https://features.hillcrestgeo.ca/fwa/functions/postgisftw.fwa_networktraceagg/items.html?blue_line_key_a=354142279&measure_a=1000&blue_line_key_b=354106004&measure_b=200">opposite sides of Finlayson Arm</a></p></li>
<li><p>between <a href="https://features.hillcrestgeo.ca/fwa/functions/postgisftw.fwa_networktraceagg/items.html?blue_line_key_a=356364114&measure_a=96830&blue_line_key_b=356570348&measure_b=41162">Chilliwack and Nelson</a></p></li>
</ul>
</section>
</section>
</section>
<section id="fwa-segmentalonginterval">
<h2>FWA_SegmentAlongInterval<a class="headerlink" href="#fwa-segmentalonginterval" title="Link to this heading"></a></h2>
<section id="id23">
<h3>Synopsis<a class="headerlink" href="#id23" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_SegmentAlongInterval</span><span class="p">(</span>
<span class="w">  </span><span class="n">blue_line_key</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">interval_length</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">  </span><span class="n">start_measure</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">end_measure</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id24">
<h3>Description<a class="headerlink" href="#id24" title="Link to this heading"></a></h3>
<p>Return a table representing segments of given equal interval along a stream, between input locations.
Note that final stream segment is the remainder of the stream under the given interval.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>field</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>integer</p></td>
<td><p>0 based index of returned features</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code></p></td>
<td><p>double precision</p></td>
<td><p>measure value of start point of segment</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">upstream_route_measure</span></code></p></td>
<td><p>double precision</p></td>
<td><p>measure value of end point of segment</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">geom</span></code></p></td>
<td><p>geometry(MultiLineString, 3005)</p></td>
<td><p>Geometry of stream between the given measures</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id25">
<h3>Example<a class="headerlink" href="#id25" title="Link to this heading"></a></h3>
<p>Return stream segments at a 100m interval along the entire Goldstream river:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">SELECT</span>
<span class="w">     </span><span class="k">index</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">     </span><span class="n">downstream_route_measure</span><span class="p">,</span>
<span class="w">     </span><span class="n">upstream_route_measure</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">FWA_SegmentAlongInterval</span><span class="p">(</span>
<span class="w">    </span><span class="mi">354152425</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="mi">100</span>
<span class="w">    </span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="nb">id</span>  <span class="o">|</span> <span class="n">downstream_route_measure</span> <span class="o">|</span> <span class="n">upstream_route_measure</span> <span class="o">|</span> <span class="n">st_astext</span>            
<span class="o">-----+--------------------------+------------------------+-------------------</span>
   <span class="mi">0</span> <span class="o">|</span>                      <span class="mi">100</span> <span class="o">|</span>                    <span class="mi">200</span> <span class="o">|</span> <span class="n">MULTILINESTRING</span> <span class="n">Z</span> <span class="p">((</span>
   <span class="mi">1</span> <span class="o">|</span>                      <span class="mi">200</span> <span class="o">|</span>                    <span class="mi">300</span> <span class="o">|</span> <span class="n">MULTILINESTRING</span> <span class="n">Z</span> <span class="p">((</span>
   <span class="mi">2</span> <span class="o">|</span>                      <span class="mi">300</span> <span class="o">|</span>                    <span class="mi">400</span> <span class="o">|</span> <span class="n">MULTILINESTRING</span> <span class="n">Z</span> <span class="p">((</span>
 
<span class="o">...</span>
</pre></div>
</div>
</section>
</section>
<section id="fwa-slopealonginterval">
<h2>FWA_SlopeAlongInterval<a class="headerlink" href="#fwa-slopealonginterval" title="Link to this heading"></a></h2>
<section id="id26">
<h3>Synopsis<a class="headerlink" href="#id26" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_SlopeAlongInterval</span><span class="p">(</span>
<span class="w">  </span><span class="n">blue_line_key</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">interval_length</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">  </span><span class="n">distance_upstream</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">  </span><span class="n">start_measure</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">end_measure</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id27">
<h3>Description<a class="headerlink" href="#id27" title="Link to this heading"></a></h3>
<p>Return a table representing measures, elevations and slope at equal interval along a stream, between start/end measures.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>field</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">idx</span></code></p></td>
<td><p>integer</p></td>
<td><p>0 based index of returned features</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code></p></td>
<td><p>numeric</p></td>
<td><p>measure value of start point of slope measurement</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">downstream_z</span></code></p></td>
<td><p>numeric</p></td>
<td><p>elevation value at start point of slope measurement</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">upstream_route_measure</span></code></p></td>
<td><p>numeric</p></td>
<td><p>measure value of end point of slope measurement</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">upstream_z</span></code></p></td>
<td><p>numeric</p></td>
<td><p>elevation value at end point of slope measurement</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">gradient</span></code></p></td>
<td><p>numeric</p></td>
<td><p>slope of stream between downstream and upstream locations</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id28">
<h3>Example<a class="headerlink" href="#id28" title="Link to this heading"></a></h3>
<p>Return upstream 100m slopes at 100m intervals along the Bonaparte River, from 1000m to 2000m.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">SELECT</span>
<span class="w">     </span><span class="n">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">     </span><span class="n">downstream_measure</span><span class="p">,</span>
<span class="w">     </span><span class="n">downstream_z</span><span class="p">,</span>
<span class="w">     </span><span class="n">upstream_measure</span><span class="p">,</span>
<span class="w">     </span><span class="n">upstream_z</span><span class="p">,</span>
<span class="w">     </span><span class="n">gradient</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">FWA_SlopeAlongInterval</span><span class="p">(</span>
<span class="w">    </span><span class="mi">356363594</span><span class="p">,</span>
<span class="w">    </span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">    </span><span class="mi">2000</span>
<span class="w">    </span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="nb">id</span> <span class="o">|</span> <span class="n">downstream_measure</span> <span class="o">|</span> <span class="n">downstream_z</span> <span class="o">|</span> <span class="n">upstream_measure</span> <span class="o">|</span> <span class="n">upstream_z</span> <span class="o">|</span> <span class="n">gradient</span>
<span class="o">----+--------------------+--------------+------------------+------------+----------</span>
  <span class="mi">1</span> <span class="o">|</span>               <span class="mi">1000</span> <span class="o">|</span>       <span class="mf">308.11</span> <span class="o">|</span>             <span class="mi">1100</span> <span class="o">|</span>     <span class="mf">309.00</span> <span class="o">|</span>    <span class="mf">0.009</span>
  <span class="mi">2</span> <span class="o">|</span>               <span class="mi">1100</span> <span class="o">|</span>       <span class="mf">309.00</span> <span class="o">|</span>             <span class="mi">1200</span> <span class="o">|</span>     <span class="mf">309.47</span> <span class="o">|</span>    <span class="mf">0.005</span>
  <span class="mi">3</span> <span class="o">|</span>               <span class="mi">1200</span> <span class="o">|</span>       <span class="mf">309.47</span> <span class="o">|</span>             <span class="mi">1300</span> <span class="o">|</span>     <span class="mf">310.00</span> <span class="o">|</span>    <span class="mf">0.005</span>
  <span class="mi">4</span> <span class="o">|</span>               <span class="mi">1300</span> <span class="o">|</span>       <span class="mf">310.00</span> <span class="o">|</span>             <span class="mi">1400</span> <span class="o">|</span>     <span class="mf">310.82</span> <span class="o">|</span>    <span class="mf">0.008</span>
  <span class="mi">5</span> <span class="o">|</span>               <span class="mi">1400</span> <span class="o">|</span>       <span class="mf">310.82</span> <span class="o">|</span>             <span class="mi">1500</span> <span class="o">|</span>     <span class="mf">313.82</span> <span class="o">|</span>    <span class="mf">0.030</span>
  <span class="mi">6</span> <span class="o">|</span>               <span class="mi">1500</span> <span class="o">|</span>       <span class="mf">313.82</span> <span class="o">|</span>             <span class="mi">1600</span> <span class="o">|</span>     <span class="mf">315.62</span> <span class="o">|</span>    <span class="mf">0.018</span>
  <span class="mi">7</span> <span class="o">|</span>               <span class="mi">1600</span> <span class="o">|</span>       <span class="mf">315.62</span> <span class="o">|</span>             <span class="mi">1700</span> <span class="o">|</span>     <span class="mf">317.26</span> <span class="o">|</span>    <span class="mf">0.016</span>
  <span class="mi">8</span> <span class="o">|</span>               <span class="mi">1700</span> <span class="o">|</span>       <span class="mf">317.26</span> <span class="o">|</span>             <span class="mi">1800</span> <span class="o">|</span>     <span class="mf">318.78</span> <span class="o">|</span>    <span class="mf">0.015</span>
  <span class="mi">9</span> <span class="o">|</span>               <span class="mi">1800</span> <span class="o">|</span>       <span class="mf">318.78</span> <span class="o">|</span>             <span class="mi">1900</span> <span class="o">|</span>     <span class="mf">320.32</span> <span class="o">|</span>    <span class="mf">0.015</span>
 <span class="mi">10</span> <span class="o">|</span>               <span class="mi">1900</span> <span class="o">|</span>       <span class="mf">320.32</span> <span class="o">|</span>             <span class="mi">2000</span> <span class="o">|</span>     <span class="mf">322.39</span> <span class="o">|</span>    <span class="mf">0.021</span>
</pre></div>
</div>
</section>
<section id="id29">
<h3>Web service<a class="headerlink" href="#id29" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://features.hillcrestgeo.ca/fwa/functions/postgisftw.fwa_slopealonginterval.html">FWA_SlopeAlongInterval</a></p>
<p>Make the same request as the <a class="reference external" href="https://features.hillcrestgeo.ca/fwa/functions/postgisftw.fwa_slopealonginterval/items.json?blue_line_key=356363594&amp;amp;interval_length=100&amp;amp;distance_upstream=100&amp;amp;start_measure=1000&amp;amp;end_measure=2000">example above</a></p>
</section>
</section>
<section id="fwa-streamsasmvt">
<h2>FWA_StreamsAsMVT<a class="headerlink" href="#fwa-streamsasmvt" title="Link to this heading"></a></h2>
<section id="id30">
<h3>Synopsis<a class="headerlink" href="#id30" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_StreamsAsMVT</span><span class="p">(</span>
<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="nb">integer</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id31">
<h3>Description<a class="headerlink" href="#id31" title="Link to this heading"></a></h3>
<p>Return FWA streams as MVT, filtering by <code class="docutils literal notranslate"><span class="pre">stream_order_max</span></code> (the maximum order of a given stream / <code class="docutils literal notranslate"><span class="pre">blue_line_key</span></code>) based on the provided zoom level.
Enables fast display of source 1:20,000 streams at all zoom levels (show full length of higher order streams at lower zooms), using <code class="docutils literal notranslate"><span class="pre">pg_tileserv</span></code>.</p>
<p>Note: for databases with modest resources, tiles at low zoom levels may be slow to render. The function should still be speedy enough for general use if <a class="reference external" href="https://github.com/CrunchyData/pg_tileserv#basic-operation">pg_tileserv is behind a cache</a>.</p>
</section>
<section id="id32">
<h3>Web service<a class="headerlink" href="#id32" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://tiles.hillcrestgeo.ca/bcfishpass/postgisftw.fwa_streamsasmvt.html">FWA_StreamsAsMVT</a></p>
</section>
</section>
<section id="fwa-upstream">
<h2>FWA_Upstream<a class="headerlink" href="#fwa-upstream" title="Link to this heading"></a></h2>
<section id="id33">
<h3>Synopsis<a class="headerlink" href="#id33" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- compare watershed codes only</span>
<span class="n">FWA_Upstream</span><span class="p">(</span>
<span class="w">    </span><span class="n">wscode_ltree_a</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">localcode_ltree_a</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">wscode_ltree_b</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">localcode_ltree_b</span><span class="w"> </span><span class="n">ltree</span>
<span class="p">)</span>

<span class="c1">-- compare watershed codes and route positions (lines)</span>
<span class="n">FWA_Upstream</span><span class="p">(</span>
<span class="w">    </span><span class="n">blue_line_key_a</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">downstream_route_measure_a</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="p">,</span>
<span class="w">    </span><span class="n">upstream_route_measure_a</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="p">,</span>
<span class="w">    </span><span class="n">wscode_ltree_a</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">localcode_ltree_a</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">blue_line_key_b</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">downstream_route_measure_b</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="p">,</span>
<span class="w">    </span><span class="n">wscode_ltree_b</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">localcode_ltree_b</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">include_equivalents</span><span class="w"> </span><span class="nb">boolean</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">False</span><span class="p">,</span>
<span class="w">    </span><span class="n">tolerance</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">.</span><span class="mi">001</span>
<span class="p">)</span>

<span class="c1">-- compare watershed codes and route positions (points)</span>
<span class="n">FWA_Upstream</span><span class="p">(</span>
<span class="w">    </span><span class="n">blue_line_key_a</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">downstream_route_measure_a</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="p">,</span>
<span class="w">    </span><span class="n">wscode_ltree_a</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">localcode_ltree_a</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">blue_line_key_b</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">downstream_route_measure_b</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="p">,</span>
<span class="w">    </span><span class="n">wscode_ltree_b</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">localcode_ltree_b</span><span class="w"> </span><span class="n">ltree</span><span class="p">,</span>
<span class="w">    </span><span class="n">include_equivalents</span><span class="w"> </span><span class="nb">boolean</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">False</span><span class="p">,</span>
<span class="w">    </span><span class="n">tolerance</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">.</span><span class="mi">001</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id34">
<h3>Description<a class="headerlink" href="#id34" title="Link to this heading"></a></h3>
<p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the watershed codes / measures B are upstream of watershed codes / measure A.</p>
<p>For polygonal features (where no <code class="docutils literal notranslate"><span class="pre">blue_line_key</span></code> / <code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code> is present), use the shorter form of the function.</p>
<p>For line features, use the form of the function with <code class="docutils literal notranslate"><span class="pre">blue_line_key</span></code>, <code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code> and <code class="docutils literal notranslate"><span class="pre">upstream_route_measure</span></code></p>
<p>For point features, use the form of the function with <code class="docutils literal notranslate"><span class="pre">blue_line_key</span></code> and <code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code>, but not <code class="docutils literal notranslate"><span class="pre">upstream_route_measure</span></code></p>
<p>Specify <code class="docutils literal notranslate"><span class="pre">True</span></code> for <code class="docutils literal notranslate"><span class="pre">include_equivalents</span></code> if you want to evaluate as true for features with exactly the same linear position.</p>
</section>
<section id="id35">
<h3>Examples<a class="headerlink" href="#id35" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p>At its most basic, the function compares two watershed code / local code <code class="docutils literal notranslate"><span class="pre">ltree</span></code> pairs and returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the second pair is upstream of the first pair.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">FWA_Upstream</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;100.100000&#39;</span><span class="p">::</span><span class="n">ltree</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;100.100000&#39;</span><span class="p">::</span><span class="n">ltree</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;100.100000.000100&#39;</span><span class="p">::</span><span class="n">ltree</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;100.100000.000100&#39;</span><span class="p">::</span><span class="n">ltree</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">fwa_upstream</span>
<span class="o">--------------</span>
 <span class="n">t</span>
</pre></div>
</div>
</li>
<li><p>Find features upstream of a known location on the network. This query finds the number of lakes upstream of the Mission/Terzaghi Dam on the Bridge River. As source FWA lakes do not have a <code class="docutils literal notranslate"><span class="pre">local_watershed_code</span></code> value, we use the <code class="docutils literal notranslate"><span class="pre">fwapg</span></code> lookup.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">n_lakes</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">whse_basemapping</span><span class="p">.</span><span class="n">fwa_lakes_poly</span><span class="w"> </span><span class="n">l</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">whse_basemapping</span><span class="p">.</span><span class="n">fwa_waterbodies</span><span class="w"> </span><span class="n">wb</span>
<span class="k">ON</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">waterbody_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb</span><span class="p">.</span><span class="n">waterbody_key</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">FWA_Upstream</span><span class="p">(</span><span class="s1">&#39;100.239855&#39;</span><span class="p">,</span><span class="s1">&#39;100.239855.240724&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">wb</span><span class="p">.</span><span class="n">wscode_ltree</span><span class="p">,</span><span class="w"> </span><span class="n">wb</span><span class="p">.</span><span class="n">localcode_ltree</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">n_lakes</span>
<span class="o">---------</span>
     <span class="mi">998</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>For each feature in table A, find all records upstream in table B and collect them into an array. This query lists all dams upstream of each fish passage field assessment location (data from <a class="reference external" href="https://github.com/smnorris/bcfishpass"><code class="docutils literal notranslate"><span class="pre">bcfishpass</span></code></a>)</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">aggregated_crossings_id</span><span class="p">,</span>
<span class="w">  </span><span class="n">array_agg</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">dam_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">upstream_dam_ids</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">bcfishpass</span><span class="p">.</span><span class="n">crossings</span><span class="w"> </span><span class="n">a</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">bcfishpass</span><span class="p">.</span><span class="n">dams</span><span class="w"> </span><span class="n">b</span>
<span class="k">ON</span><span class="w"> </span><span class="n">FWA_Upstream</span><span class="p">(</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">blue_line_key</span><span class="p">,</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">downstream_route_measure</span><span class="p">,</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">wscode_ltree</span><span class="p">,</span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="n">localcode_ltree</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">blue_line_key</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">downstream_route_measure</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">wscode_ltree</span><span class="p">,</span>
<span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">localcode_ltree</span>
<span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">stream_crossing_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">aggregated_crossings_id</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">aggregated_crossings_id</span> <span class="o">|</span> <span class="n">upstream_dam_ids</span>
<span class="o">-------------------------+-----------------------</span>
                   <span class="mi">69195</span> <span class="o">|</span> <span class="p">{</span><span class="mi">163</span><span class="p">}</span>
                  <span class="mi">196198</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1427</span><span class="p">,</span><span class="mi">2362</span><span class="p">}</span>
                  <span class="mi">195590</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1914</span><span class="p">}</span>
                   <span class="mi">51959</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2371</span><span class="p">}</span>
                  <span class="mi">103090</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1085</span><span class="p">,</span><span class="mi">1693</span><span class="p">,</span><span class="mi">1483</span><span class="p">}</span>
                  <span class="mi">103088</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1693</span><span class="p">}</span>
                    <span class="mi">7520</span> <span class="o">|</span> <span class="p">{</span><span class="mi">416</span><span class="p">,</span><span class="mi">1129</span><span class="p">,</span><span class="mi">708</span><span class="p">,</span><span class="mi">1937</span><span class="p">,</span><span class="mi">1128</span><span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="fwa-upstreamtrace">
<h2>FWA_UpstreamTrace<a class="headerlink" href="#fwa-upstreamtrace" title="Link to this heading"></a></h2>
<section id="id36">
<h3>Synopsis<a class="headerlink" href="#id36" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_UpstreamTrace</span><span class="p">(</span>
<span class="w">  </span><span class="n">start_blue_line_key</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">start_measure</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>
<span class="w">  </span><span class="n">tolerance</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id37">
<h3>Description<a class="headerlink" href="#id37" title="Link to this heading"></a></h3>
<p>Return all records from <code class="docutils literal notranslate"><span class="pre">whse_basemapping.fwa_stream_networks_sp</span></code> that are upstream of provided location.
Where the provided location is more than the provided tolerance (metres) from the endpoint of the stream segment
on which it lies, split the source stream segment and only include the portion upstream of the location in the returned records.</p>
</section>
<section id="id38">
<h3>Example<a class="headerlink" href="#id38" title="Link to this heading"></a></h3>
<p>A common use case would be to use this in combination with <code class="docutils literal notranslate"><span class="pre">FWA_IndexPoint</span></code>, extracting streams upstream of coordinates of a feature like a bridge:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- find blkey/measure of bridge over sooke river</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">blue_line_key</span><span class="p">,</span><span class="w"> </span><span class="n">downstream_route_measure</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">postgisftw</span><span class="p">.</span><span class="n">FWA_IndexPoint</span><span class="p">(</span><span class="o">-</span><span class="mi">123</span><span class="p">.</span><span class="mi">7028</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">3858</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">blue_line_key</span> <span class="o">|</span> <span class="n">downstream_route_measure</span> 
<span class="o">---------------+--------------------------</span>
 <span class="mi">354153927</span>     <span class="o">|</span>        <span class="mf">350.3003598130115</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- extract streams</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">FWA_UpstreamTrace</span><span class="p">(</span><span class="mi">354153927</span><span class="p">,</span><span class="w"> </span><span class="mi">350</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id39">
<h3>Web service<a class="headerlink" href="#id39" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://features.hillcrestgeo.ca/fwa/functions/fwa_upstreamtrace.html">FWA_UpstreamTrace</a></p>
</section>
</section>
<section id="fwa-watershedatmeasure">
<span id="id40"></span><h2>FWA_WatershedAtMeasure<a class="headerlink" href="#fwa-watershedatmeasure" title="Link to this heading"></a></h2>
<section id="id41">
<h3>Synopsis<a class="headerlink" href="#id41" title="Link to this heading"></a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">FWA_WatershedAtMeasure</span><span class="p">(</span>
<span class="w">    </span><span class="n">blue_line_key</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">downstream_route_measure</span><span class="w"> </span><span class="nb">float</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id42">
<h3>Description<a class="headerlink" href="#id42" title="Link to this heading"></a></h3>
<p>Given a point defined by its position on the FWA stream network (<code class="docutils literal notranslate"><span class="pre">blue_line_key</span></code>,<code class="docutils literal notranslate"><span class="pre">downstream_route_measure</span></code>), return a table containing a polygon geometry that defines the point’s upstream watershed.</p>
<p>Watershed delineation following this set of rules, in order of descending priority:</p>
<ol class="arabic simple">
<li><p>If the point is within a lake, return everything upstream of the lake’s <em>outflow</em></p></li>
<li><p>If the point is within a polygonal river/canal the fundamental watersheds are
cut across the banks of the river/canal before being included in the aggregation</p></li>
<li><p>If the point is &lt; 100m downstream from the top of the fundamental
watershed in which it falls, then that fundamental watershed is not included in the aggregation</p></li>
<li><p>If the point is &lt; 50 m upstream from the bottom of the fundamental
watershed in which it falls, then that watershed is included in the aggregation</p></li>
</ol>
<p>For trans-boundary watersheds, the results include non-BC areas (not present in the FWA) thanks to data <a class="reference external" href="https://github.com/smnorris/fwapg/tree/main/extras/xborder">provided by DFO</a>.</p>
<p>The table returned includes these columns:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>field</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">wscode_ltree</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ltree</span></code></p></td>
<td><p>watershed code of the source point</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">localcode_ltree</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ltree</span></code></p></td>
<td><p>local watershed code of the source point</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">area_ha</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">numeric</span></code></p></td>
<td><p>area of output geometry, hectares</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">refine_method</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">text</span></code></p></td>
<td><p>how the watershed was processed / what further processing may be required</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">geom</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">geometry(Polygon,</span> <span class="pre">3005)</span></code></p></td>
<td><p>a polygon representing the watershed contributing to the input location</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">refine_method</span></code> field in the output table has several possible values:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>value</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">CUT</span></code></p></td>
<td><p>Input point falls in a river/canal, output geometry is cut across the banks of the river/canal</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">DEM</span></code></p></td>
<td><p>Input point falls on a linear stream &gt;50m upstream from outlet of input watershed and &gt;100m downstream from top of watershed, further processing of the fundamental watershed in which the point lies with the DEM would be valuable to improve the output watershed. This is functionally equivalent to the <code class="docutils literal notranslate"><span class="pre">DROP</span></code> value, the fundamental watershed in which the point lies is not included in the output geometry</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">DROP</span></code></p></td>
<td><p>Input point falls on a linear stream and is &lt;=100m downstream from the top of the fundamental watershed in which it lies - this fundamental watershed is not included in output geometry</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">KEEP</span></code></p></td>
<td><p>Input point falls on a linear stream and is &lt;=50m upstream from the outlet of the fundamental watershed in which it lies - this fundamental watershed is entirely retained in the output geometry</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">LAKE</span></code></p></td>
<td><p>Input point falls within a lake/reservoir - watershed returned includes everything upstream of the outlet of the lake/reservoir</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id43">
<h3>Examples<a class="headerlink" href="#id43" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p>Extract the geometry of the watershed upstream of the Cowichan River at Hwy 19:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FWA_WatershedAtMeasure</span><span class="p">(</span><span class="mi">354155148</span><span class="p">,</span><span class="w"> </span><span class="mi">49129</span><span class="p">.</span><span class="mi">75</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="watershed" src="_images/watershed5.png" /></p>
</li>
<li><p>Extract the watershed upstream of Chilliwack Lake:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">indexed_pt</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">i</span><span class="p">.</span><span class="o">*</span>
<span class="w">  </span><span class="k">FROM</span>
<span class="w">  </span><span class="p">(</span>
<span class="w">    </span><span class="c1">-- find a point in the lake</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">st_pointonsurface</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">geom</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">whse_basemapping</span><span class="p">.</span><span class="n">fwa_lakes_poly</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">gnis_name_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Chilliwack Lake&#39;</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pt</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">LATERAL</span>
<span class="w">  </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="w">    </span><span class="k">FROM</span>
<span class="w">    </span><span class="n">FWA_IndexPoint</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="c1">-- index the point in the lake to the nearest FWA stream</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">true</span>
<span class="p">)</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">FWA_WatershedAtMeasure</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">blue_line_key</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">indexed_pt</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">downstream_route_measure</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">indexed_pt</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">wscode_ltree</span>    <span class="o">|</span>     <span class="n">localcode_ltree</span>      <span class="o">|</span> <span class="n">area_ha</span>  <span class="o">|</span> <span class="n">refine_method</span>  <span class="o">|</span> <span class="n">geom</span>
<span class="o">-------------------+--------------------------+----------+----------------+-----</span>
 <span class="mf">100.064535.057628</span> <span class="o">|</span> <span class="mf">100.064535.057628.634957</span> <span class="o">|</span> <span class="mf">33478.28</span> <span class="o">|</span> <span class="n">LAKE</span>           <span class="o">|</span>
</pre></div>
</div>
<p>Mapped, the geometry looks like this - the USA portion of the watershed is included:</p>
<p><img alt="watershed" src="_images/watershed6.png" /></p>
</li>
</ol>
</section>
<section id="id44">
<h3>Web service<a class="headerlink" href="#id44" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://features.hillcrestgeo.ca/fwa/functions/fwa_watershedatmeasure.html">FWA_WatershedAtMeasure</a></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="02_tables_views.html" class="btn btn-neutral float-left" title="Value added table/view reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Simon Norris.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>